<% layout("layouts/boilerplate") %>

    <style>
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .page-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
        }

        .filter-label {
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .filter-select {
            border: 2px solid #E8E8E8;
            border-radius: 10px;
            padding: 0.6rem 1rem;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
        }

        .btn-filter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .btn-clear {
            background: #E8E8E8;
            color: #34495E;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-clear:hover {
            background: #D0D0D0;
        }

        .tickets-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .table {
            margin: 0;
        }

        .table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .table th {
            font-weight: 600;
            border: none;
            padding: 1rem;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
        }

        .table tbody tr {
            transition: all 0.2s ease;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
        }

        .ticket-id {
            font-weight: 700;
            color: #667eea;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .ticket-id:hover {
            text-decoration: underline;
        }

        .badge {
            padding: 0.5rem 1rem;
            font-weight: 600;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .status-open {
            background: #4CAF50;
            color: white;
        }

        .status-inprogress {
            background: #FF9800;
            color: white;
        }

        .status-resolved {
            background: #2196F3;
            color: white;
        }

        .status-closed {
            background: #9E9E9E;
            color: white;
        }

        .priority-critical {
            color: #D32F2F;
            font-weight: 800;
        }

        .priority-high {
            color: #F44336;
            font-weight: 700;
        }

        .priority-medium {
            color: #FF9800;
            font-weight: 600;
        }

        .priority-low {
            color: #4CAF50;
            font-weight: 500;
        }

        .btn-action {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.4rem 1rem;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #7F8C8D;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .ticket-count {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            display: inline-block;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 1rem;
        }
    </style>

    <div class="container-fluid mt-4">
        <div class="page-header">
            <h1><i class="fas fa-list-ul"></i> All Tickets</h1>
            <p>Manage and track all support tickets</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <form action="/tickets" method="GET">
                <div class="row align-items-end">
                    <div class="col-md-3">
                        <label class="filter-label">Status</label>
                        <select name="status" class="form-select filter-select">
                            <option value="">All Status</option>
                            <option value="Open" <%=filter.status==='Open' ? 'selected' : '' %>>Open</option>
                            <option value="In Progress" <%=filter.status==='In Progress' ? 'selected' : '' %>>In
                                Progress</option>
                            <option value="Resolved" <%=filter.status==='Resolved' ? 'selected' : '' %>>Resolved
                            </option>
                            <option value="Closed" <%=filter.status==='Closed' ? 'selected' : '' %>>Closed</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="filter-label">Priority</label>
                        <select name="priority" class="form-select filter-select">
                            <option value="">All Priorities</option>
                            <option value="Low" <%=filter.priority==='Low' ? 'selected' : '' %>>Low</option>
                            <option value="Medium" <%=filter.priority==='Medium' ? 'selected' : '' %>>Medium</option>
                            <option value="High" <%=filter.priority==='High' ? 'selected' : '' %>>High</option>
                            <option value="Critical" <%=filter.priority==='Critical' ? 'selected' : '' %>>Critical
                            </option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="filter-label">Category</label>
                        <select name="category" class="form-select filter-select">
                            <option value="">All Categories</option>
                            <option value="Technical" <%=filter.category==='Technical' ? 'selected' : '' %>>Technical
                            </option>
                            <option value="Billing" <%=filter.category==='Billing' ? 'selected' : '' %>>Billing</option>
                            <option value="Product" <%=filter.category==='Product' ? 'selected' : '' %>>Product</option>
                            <option value="Service" <%=filter.category==='Service' ? 'selected' : '' %>>Service</option>
                            <option value="Complaint" <%=filter.category==='Complaint' ? 'selected' : '' %>>Complaint
                            </option>
                            <option value="Other" <%=filter.category==='Other' ? 'selected' : '' %>>Other</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-filter w-100">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-12">
                        <a href="/tickets" class="btn btn-clear">
                            <i class="fas fa-times-circle"></i> Clear Filters
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <div class="ticket-count">
            <i class="fas fa-ticket-alt"></i> Showing <%= tickets.length %> ticket(s)
        </div>

        <!-- Tickets Table -->
        <div class="tickets-container">
            <% if (tickets.length> 0) { %>
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Ticket ID</th>
                            <th>Customer</th>
                            <th>Subject</th>
                            <th>Category</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Department</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% tickets.forEach(ticket=> { %>
                            <tr>
                                <td>
                                    <a href="/tickets/<%= ticket._id %>" class="ticket-id">
                                        <%= ticket.ticketNumber %>
                                    </a>
                                </td>
                                <td>
                                    <strong>
                                        <%= ticket.customerName %>
                                    </strong><br>
                                    <small class="text-muted">
                                        <%= ticket.customerEmail %>
                                    </small>
                                </td>
                                <td>
                                    <%= ticket.subject.substring(0, 50) %>
                                        <%= ticket.subject.length> 50 ? '...' : '' %>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">
                                        <%= ticket.category %>
                                    </span>
                                </td>
                                <td>
                                    <span class="priority-<%= ticket.priority.toLowerCase() %>">
                                        <%= ticket.priority %>
                                    </span>
                                </td>
                                <td>
                                    <span class="badge status-<%= ticket.status.toLowerCase().replace(' ', '') %>">
                                        <%= ticket.status %>
                                    </span>
                                </td>
                                <td>
                                    <%= ticket.department %>
                                </td>
                                <td>
                                    <%= new Date(ticket.createdAt).toLocaleDateString('en-IN', { day: 'numeric' ,
                                        month: 'short' , year: 'numeric' }) %>
                                </td>
                                <td>
                                    <a href="/tickets/<%= ticket._id %>" class="btn-action">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No Tickets Found</h3>
                        <p>Try adjusting your filters or create a new ticket</p>
                        <a href="/tickets/new" class="btn btn-action mt-3">
                            <i class="fas fa-plus-circle"></i> Raise New Ticket
                        </a>
                    </div>
                    <% } %>
        </div>
    </div>